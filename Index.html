<!DOCTYPE html>
<html>

<head>
  <title>Screenshot Effect</title>
  <style>
    #imageContainer {
      width: 500px;
      /* Adjust as needed */
      height: auto;
      border: 1px solid #ccc;
      overflow: hidden;
      /* Hide excess image due to scaling */
    }

    #imageContainer img {
      width: 100%;
      height: auto;
    }
  </style>
</head>

<body>
  <input type="file" id="imageUpload" accept="image/*">
  <input type="number" id="iterations" min="1" value="1">
  <button id="applyEffect">Apply Effect</button>

  <div id="imageContainer"></div>

  <script>
    const imageUpload = document.getElementById('imageUpload');
    const iterationsInput = document.getElementById('iterations');
    const applyEffectButton = document.getElementById('applyEffect');
    const imageContainer = document.getElementById('imageContainer');

    applyEffectButton.addEventListener('click', () => {
      const file = imageUpload.files[0];
      const iterations = parseInt(iterationsInput.value);

      if (file) {
        const reader = new FileReader();

        reader.onload = (e) => {
          const img = document.createElement('img');
          img.src = e.target.result;

          imageContainer.innerHTML = '';
          imageContainer.appendChild(img);

          applyScreenshotEffect(img, iterations);
        }

        reader.readAsDataURL(file);
      }
    });

    function applyScreenshotEffect(img, iterations) {
      let currentImage = img.src;
      let quality = 0.95; // Initial JPEG quality
      const qualityStep = quality / iterations; // Quality reduction per iteration

      for (let i = 0; i < iterations; i++) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = img.width;
        canvas.height = img.height;

        // Draw the current image onto the canvas
        ctx.drawImage(img, 0, 0);

        currentImage = canvas.toDataURL('image/jpeg', quality);

        // Urpdate the image source with the new compressed image data
        img.src = currentImage;

        quality -= qualityStep;
        if (quality < 0.1) {
          quality = 0.1;
        }
      }

      // No need to set img.src here again, it's already updated in the loop
    }
  </script>
</body>

</html>
